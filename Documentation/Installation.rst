Installation 
===========


## Github
Katydid source can be found on the [Project 8 Github repository](https://github.com/project8/katydid).  
The master branch of the source code can be cloned from the Github repository in the standard way (assuming you have Git installed and configured on your computer):

    > git clone https://github.com/project8/katydid.git

Follow the installation instructions in the top-level README file, which also shows up on the front page of the Github Katydid webpage. 


### Matlab

The Matlab Compiler Runtime (MCR) is used to read Matlab files (.mat) generated by the Tektronix RSA.  If the user wishes to read the mat files, the user must install MCR and enable it on Katydid at compilation file.  

First, download the Matlab Compiler Runtime (MCR) version 2014a from the website:
`http://www.mathworks.com/products/compiler/mcr/`

Then unzip it and install it by running:
`./install`

When the installer finishes, it will give you a list of directories to append to the LD_LIBRARY_PATH environmental variable.  Ignore it.  Add only the following folders, either to LD_FALLBACK_LIBRARY_PATH (MAC) or LD_LIBRARY_PATH (LINUX):
`/Applications/MATLAB/MATLAB_Compiler_Runtime/v83/runtime/maci64:/Applications/MATLAB/MATLAB_Compiler_Runtime/v83/bin/maci64`

To enable Matlab in Katydid, before you compile it with make, run ccmake and set the flag "Katydid_USE_MATLAB" to ON.  Then set the variables MATLAB_INCLUDE_DIR and MATLAB_LIBRARY_DIR to the appropriate paths.  The defaults are, respectively:
* /Applications/MATLAB/MATLAB_Compiler_Runtime/v83/extern/include
* /Applications/MATLAB/MATLAB_Compiler_Runtime/v83/bin/maci64

Finally, when configuring the egg-processor with a JSON file, use `"egg-reader": "rsamat"`.


## Finding and linking to libraries and packages:

cmake looks for libraries using environment 
variables defined in the FindPackage.cmake files.  
Some of these FindPackage.cmake files are distributed with
Katydid.  Other FindPackage.cmake files may already reside
in group directories on the local Linux machine.
The ~/katydid/cmake/*.cmake files should override
the local *.cmake files but this needs to be 
confirmed.

The required environment variables should be 
defined, for example, in the .bashrc file as

export BOOST_ROOT=/path/to/boost_1_55_0 <br>
echo $BOOST_ROOT

If there is no *.cmake file immediately available 
for a particular library/package, then the environment 
variables can be defined on the cmake command line
one at a time.  For example, for a locally-installed
version of Protobuf without a FindProtobuf.cmake file,
the cmake syntax for Katydid can work like this:

> cmake -DPROTOBUF_INCLUDE_DIR=/path/to/include 
-DPROTOBUF_LIBRARY=/path/to/include/lib/libprotobuf.so 
-DPROTOBUF_PROTOC_LIBRARY=/path/to/include/lib/libprotoc.so 
-DPROTOBUF_PROTOC_EXECUTABLE=/path/to/include/bin/protoc ~/katydid

# Installation Problems

* There's a bug in Boost that's a problem when compiling with LLVM (including using the default compiler in Mac OS X 10.7).  This was fixed in Boost 1.49.00.  If you don't have access to that version you can fix the problem by making the following change:  on line 565 of boost/signals2/detail/auto_buffer.hpp, change the word "size" to "size_arg" (not including the quotes).  Boost need not be recompiled.

* Building Katydid with clang (e.g. Mac using Xcode and Boost installed via HomeBrew)
    * Error message: " ./boost/atomic/detail/gcc-atomic.hpp:961:64: error: no matching constructor for initialization of 'storage_type' (aka 'boost::atomics::detail::storage128_type') "
    * Problem observed on a Mac with Boost-1.55.0 installed via HomeBrew.  This problem has been patched for later versions of Boost, but not on the latest version available on HomeBrew.
    * Fix: 
        1. Update Boost.  If already using latest version, try the following.
        1. Download gcc-atomic.hpp and cas128strong.hpp with fixes suggested from:
            - https://github.com/boostorg/atomic/commit/e4bde20f2eec0a51be14533871d2123bd2ab9cf3
            - https://github.com/boostorg/atomic/commit/6bb71fdd8f7cc346d90fb14beb38b7297fc1ffd9

* Compile fails at 2% with a protobuf problem that looks like this:

    
Linking CXX shared library libMonarchProto.dylib
Undefined symbols for architecture x86_64:
  "google::protobuf::MessageFactory::InternalRegisterGeneratedFile(char const*, void (*)(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&))", referenced from:
      Protobuf::protobuf_AddDesc_MonarchHeader_2eproto() in MonarchHeader.pb.cc.o
  "google::protobuf::internal::WireFormatLite::ReadString(google::protobuf::io::CodedInputStream*, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*)", referenced from:
      Protobuf::MonarchHeader::MergePartialFromCodedStream(google::protobuf::io::CodedInputStream*) in MonarchHeader.pb.cc.o
  "google::protobuf::internal::WireFormatLite::WriteString(int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, google::protobuf::io::CodedOutputStream*)", referenced from:
      Protobuf::MonarchHeader::SerializeWithCachedSizes(google::protobuf::io::CodedOutputStream*) const in MonarchHeader.pb.cc.o
  "google::protobuf::DescriptorPool::FindFileByName(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) const", referenced from:
      Protobuf::protobuf_AssignDesc_MonarchHeader_2eproto() in MonarchHeader.pb.cc.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[2]: *** [Source/Egg/Monarch/Protobuf/libMonarchProto.dylib] Error 1
make[1]: *** [Source/Egg/Monarch/Protobuf/CMakeFiles/MonarchProto.dir/all] Error 2
make: *** [all] Error 2

This is an error related to mixing libc++ and libstdc++.  Protobuf needs to be compiled with the following flags:

CXXFLAGS+="-stdlib=libc++"
LIBS+="-lc++"

For homebrew installing protobuf-2.5.0, do the following:

> brew edit protobuf

and add in the `def install` block the following before anything else:

ENV['CXXFLAGS']="-stdlib=libc++"
ENV['LIBS']="-lc++"

That ought to do it.  Note that word on the street is that this bug is fixed in protobuf-2.5.1-pre, so this will be fixed in the future by somebody else.
